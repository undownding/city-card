# City Card - æ™ºèƒ½åŸå¸‚å¤©æ°”å¡ç‰‡ç”Ÿæˆå™¨

City Card æ˜¯ä¸€ä¸ªåŸºäº Next.js 16 å’Œ Cloudflare æ„å»ºçš„æ™ºèƒ½åŸå¸‚å¤©æ°”å¡ç‰‡ç”Ÿæˆåº”ç”¨ã€‚å®ƒèƒ½å¤Ÿæ ¹æ®ç”¨æˆ·çš„åœ°ç†ä½ç½®è‡ªåŠ¨è·å–åŸå¸‚ä¿¡æ¯ï¼Œå¹¶ä½¿ç”¨ AI ç”Ÿæˆç²¾ç¾çš„å¤©æ°”å¡ç‰‡å›¾åƒã€‚

## é¡¹ç›®ç‰¹æ€§

- ğŸ“ **è‡ªåŠ¨å®šä½**ï¼šä½¿ç”¨æµè§ˆå™¨åœ°ç†å®šä½è·å–å½“å‰ä½ç½®
- ğŸŒ **åå‘åœ°ç†ç¼–ç **ï¼šé€šè¿‡åæ ‡è·å–åŸå¸‚åç§°ï¼ˆåŸºäº OpenStreetMap Nominatimï¼‰
- ğŸ¤– **AI å›¾åƒç”Ÿæˆ**ï¼šä½¿ç”¨ Google AI Studio (Gemini 3.1 Flash) ç”Ÿæˆé«˜è´¨é‡å¤©æ°”å¡ç‰‡
- ğŸ“¦ **äº‘å­˜å‚¨**ï¼šå¤©æ°”å¡ç‰‡å›¾åƒå­˜å‚¨åœ¨ Cloudflare R2 å¯¹è±¡å­˜å‚¨ä¸­
- ğŸ¨ **ç²¾ç¾çš„è®¾è®¡**ï¼šä½¿ç”¨ Tailwind CSS å®ç°ç°ä»£ã€å“åº”å¼çš„ç”¨æˆ·ç•Œé¢
- ğŸ”„ **ç¼“å­˜æœºåˆ¶**ï¼šå·²ç”Ÿæˆçš„å¤©æ°”å¡ç‰‡ä¼šè¢«ç¼“å­˜ï¼Œæé«˜åŠ è½½é€Ÿåº¦
- ğŸš€ **éƒ¨ç½²åœ¨ Cloudflare**ï¼šä½¿ç”¨ OpenNext éƒ¨ç½²åˆ° Cloudflare Pages

## æŠ€æœ¯æ ˆ

- **æ¡†æ¶**ï¼šNext.js 16.1.6
- **è¯­è¨€**ï¼šTypeScript
- **UI æ¡†æ¶**ï¼šTailwind CSS 3.4.0
- **AI**ï¼šGoogle Generative AI (Gemini 3.1 Flash)
- **éƒ¨ç½²**ï¼šCloudflare Pages + OpenNext
- **å­˜å‚¨**ï¼šCloudflare R2 å¯¹è±¡å­˜å‚¨
- **åœ°å›¾**ï¼šOpenStreetMap Nominatim API

## å®‰è£…

### å‰ç½®è¦æ±‚

- Node.js >= 18.0.0
- npm æˆ– yarn
- Cloudflare è´¦æˆ·ï¼ˆç”¨äºéƒ¨ç½²ï¼‰

### å®‰è£…ä¾èµ–

```bash
npm install
```

### é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.dev.vars` æ–‡ä»¶ï¼ˆæœ¬åœ°å¼€å‘ï¼‰å’Œ Cloudflare Pages ç¯å¢ƒå˜é‡ï¼š

```bash
# Cloudflare AI Gateway
AI_GATEWAY = "your-ai-gateway"

# Cloudflare R2 å­˜å‚¨æ¡¶
WEATHER_CARDS_R2_BUCKET = "your-r2-bucket-name"

# Google AI Studio APIï¼ˆå¯é€‰ï¼Œå¦‚ä½¿ç”¨ç›´æ¥ API è®¿é—®ï¼‰
GOOGLE_API_KEY = "your-google-api-key"
```

### æœ¬åœ°å¼€å‘

```bash
npm run dev
```

è®¿é—® `http://localhost:3000` æŸ¥çœ‹åº”ç”¨ã€‚

### ç”Ÿäº§æ„å»º

```bash
npm run build
```

## éƒ¨ç½²

### éƒ¨ç½²åˆ° Cloudflare Pages

```bash
# é¢„è§ˆéƒ¨ç½²
npm run preview

# æ­£å¼éƒ¨ç½²
npm run deploy
```

æˆ–é€šè¿‡ Cloudflare Pages æ§åˆ¶å°æ‰‹åŠ¨éƒ¨ç½²ã€‚

## é¡¹ç›®æˆªå›¾

### ä¸»ç•Œé¢
![ä¸»ç•Œé¢æˆªå›¾](example/project.png)

### å¤©æ°”å¡ç‰‡ç¤ºä¾‹
![åŒ—äº¬å¤©æ°”å¡ç‰‡](example/beijing.png)
![ä¸Šæµ·å¤©æ°”å¡ç‰‡](example/shanghai.png)

## ä½¿ç”¨æ–¹æ³•

1. æ‰“å¼€åº”ç”¨åï¼Œæµè§ˆå™¨ä¼šè¯·æ±‚åœ°ç†ä½ç½®æƒé™
2. å…è®¸æƒé™åï¼Œåº”ç”¨ä¼šè‡ªåŠ¨è·å–æ‚¨çš„ä½ç½®
3. é€šè¿‡åæ ‡æŸ¥è¯¢åŸå¸‚åç§°
4. è°ƒç”¨ AI ç”Ÿæˆå¤©æ°”å¡ç‰‡å›¾åƒ
5. æ˜¾ç¤ºç”Ÿæˆçš„å¤©æ°”å¡ç‰‡

### åˆ·æ–°å¤©æ°”å¡ç‰‡

å¦‚æœéœ€è¦åˆ·æ–°å¤©æ°”å¡ç‰‡ï¼Œå¯ä»¥ç‚¹å‡»"é‡è¯•"æŒ‰é’®æˆ–åˆ·æ–°é¡µé¢ã€‚

## API æ–‡æ¡£

### è·å–å¤©æ°”å¡ç‰‡

**æ¥å£**ï¼š`GET /api/image?city=<åŸå¸‚åç§°>`

**å‚æ•°**ï¼š
- `city`ï¼šåŸå¸‚åç§°ï¼ˆå¿…å¡«ï¼‰ï¼Œæ”¯æŒä¸­æ–‡ã€è‹±æ–‡ç­‰å¤šç§è¯­è¨€

**æˆåŠŸå“åº”**ï¼š
```json
{
  "imageUrl": "https://card-r2.undownding.dev/2024-02/27/beijing.webp"
}
```

**é”™è¯¯å“åº”**ï¼š
```json
{
  "error": "City parameter is required"
}
```

**çŠ¶æ€ç **ï¼š
- 200ï¼šæˆåŠŸ
- 400ï¼šå‚æ•°ç¼ºå¤±æˆ–æ— æ•ˆ
- 500ï¼šæœåŠ¡å™¨å†…éƒ¨é”™è¯¯

**ç¤ºä¾‹**ï¼š
```bash
curl "http://localhost:3000/api/image?city=åŒ—äº¬"
```

### åå‘åœ°ç†ç¼–ç 

**æ¥å£**ï¼š`GET /api/reverse-geocode?lat=<çº¬åº¦>&lon=<ç»åº¦>`

**å‚æ•°**ï¼š
- `lat`ï¼šçº¬åº¦ï¼ˆå¿…å¡«ï¼‰ï¼ŒèŒƒå›´ï¼š-90 åˆ° 90
- `lon`ï¼šç»åº¦ï¼ˆå¿…å¡«ï¼‰ï¼ŒèŒƒå›´ï¼š-180 åˆ° 180

**æˆåŠŸå“åº”**ï¼š
```json
{
  "address": {
    "city": "åŒ—äº¬",
    "town": null,
    "village": null,
    "country": "ä¸­å›½",
    "country_code": "cn",
    "postcode": "100000",
    "state": "åŒ—äº¬å¸‚"
  }
}
```

**é”™è¯¯å“åº”**ï¼š
```json
{
  "error": "lat and lon parameters are required"
}
```

**çŠ¶æ€ç **ï¼š
- 200ï¼šæˆåŠŸ
- 400ï¼šå‚æ•°ç¼ºå¤±æˆ–æ— æ•ˆ
- 500ï¼šæœåŠ¡å™¨å†…éƒ¨é”™è¯¯
- 502ï¼šç¬¬ä¸‰æ–¹ API æœåŠ¡é”™è¯¯

**ç¤ºä¾‹**ï¼š
```bash
curl "http://localhost:3000/api/reverse-geocode?lat=39.9042&lon=116.4074"
```

## é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ image/
â”‚   â”‚   â”‚   â””â”€â”€ route.ts      # ç”Ÿæˆå¤©æ°”å¡ç‰‡ API
â”‚   â”‚   â””â”€â”€ reverse-geocode/
â”‚   â”‚       â””â”€â”€ route.ts      # åå‘åœ°ç†ç¼–ç  API
â”‚   â”œâ”€â”€ layout.tsx            # æ ¹å¸ƒå±€
â”‚   â”œâ”€â”€ page.tsx              # ä¸»é¡µé¢
â”‚   â””â”€â”€ globals.css           # å…¨å±€æ ·å¼
â”œâ”€â”€ public/                   # é™æ€èµ„æº
â”œâ”€â”€ .dev.vars                 # æœ¬åœ°å¼€å‘ç¯å¢ƒå˜é‡
â”œâ”€â”€ next.config.ts            # Next.js é…ç½®
â”œâ”€â”€ open-next.config.ts       # OpenNext é…ç½®
â”œâ”€â”€ tailwind.config.ts        # Tailwind CSS é…ç½®
â”œâ”€â”€ wrangler.jsonc           # Cloudflare Wrangler é…ç½®
â””â”€â”€ package.json              # é¡¹ç›®ä¾èµ–
```

## æ•…éšœæ’é™¤æŒ‡å—

### å¸¸è§é—®é¢˜

#### 1. åœ°ç†ä½ç½®æƒé™è¢«æ‹’ç»

**ç—‡çŠ¶**ï¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯â€œæ‚¨æ‹’ç»äº†ä½ç½®è¯·æ±‚â€

**è§£å†³æ–¹æ³•**ï¼š
- åˆ·æ–°é¡µé¢ï¼Œé‡æ–°å…è®¸åœ°ç†ä½ç½®æƒé™
- æ£€æŸ¥æµè§ˆå™¨è®¾ç½®ï¼Œç¡®ä¿åœ°ç†ä½ç½®æƒé™æœªè¢«å…¨å±€ç¦ç”¨
- å°è¯•ä½¿ç”¨å…¶ä»–æµè§ˆå™¨

#### 2. æ— æ³•è·å–åŸå¸‚ä¿¡æ¯

**ç—‡çŠ¶**ï¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯â€œæ— æ³•è·å–åŸå¸‚ä¿¡æ¯â€

**è§£å†³æ–¹æ³•**ï¼š
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- ç¡®è®¤è®¾å¤‡çš„ GPS åŠŸèƒ½æ­£å¸¸
- å°è¯•åˆ·æ–°é¡µé¢é‡è¯•

#### 3. å¤©æ°”å¡ç‰‡ç”Ÿæˆå¤±è´¥

**ç—‡çŠ¶**ï¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯â€œæ— æ³•è·å–å¤©æ°”å¡ç‰‡å›¾ç‰‡â€

**è§£å†³æ–¹æ³•**ï¼š
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- åˆ·æ–°é¡µé¢é‡è¯•
- ç¡®è®¤ Cloudflare AI Gateway é…ç½®æ­£ç¡®
- æ£€æŸ¥ Google AI Studio API å¯†é’¥æ˜¯å¦æœ‰æ•ˆï¼ˆå¦‚ä½¿ç”¨ç›´æ¥ API è®¿é—®ï¼‰

#### 4. æœ¬åœ°å¼€å‘ç¯å¢ƒé—®é¢˜

**ç—‡çŠ¶**ï¼šæ— æ³•å¯åŠ¨å¼€å‘æœåŠ¡å™¨æˆ– API æ— æ³•æ­£å¸¸å·¥ä½œ

**è§£å†³æ–¹æ³•**ï¼š
- ç¡®è®¤ Node.js ç‰ˆæœ¬ >= 18.0.0
- åˆ é™¤ `node_modules` å¹¶é‡æ–°å®‰è£…ä¾èµ–ï¼š
  ```bash
  rm -rf node_modules package-lock.json
  npm install
  ```
- æ£€æŸ¥ `.dev.vars` æ–‡ä»¶ä¸­çš„ç¯å¢ƒå˜é‡é…ç½®æ˜¯å¦æ­£ç¡®

## å¼€å‘ç¯å¢ƒå¸¸è§é—®é¢˜

### 1. Cloudflare èµ„æºç»‘å®šé”™è¯¯

**é”™è¯¯ä¿¡æ¯**ï¼š`Error: WEATHER_CARDS_R2_BUCKET is not available`

**è§£å†³æ–¹æ³•**ï¼š
- ç¡®è®¤ `wrangler.jsonc` ä¸­å·²æ­£ç¡®é…ç½®èµ„æºç»‘å®š
- æ£€æŸ¥ `.dev.vars` æ–‡ä»¶ä¸­çš„æ¡¶åç§°æ˜¯å¦æ­£ç¡®
- ç¡®è®¤ Cloudflare R2 å­˜å‚¨æ¡¶å·²åˆ›å»º

### 2. AI Gateway è¿æ¥é—®é¢˜

**é”™è¯¯ä¿¡æ¯**ï¼š`Error: AI instance not available`

**è§£å†³æ–¹æ³•**ï¼š
- ç¡®è®¤ Cloudflare AI Gateway é…ç½®æ­£ç¡®
- æ£€æŸ¥ `wrangler.jsonc` ä¸­çš„ `ai` èµ„æºç»‘å®š
- ç¡®è®¤ AI Gateway æœåŠ¡å¯ç”¨

### 3. æ„å»ºå¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼šæ„å»ºè¿‡ç¨‹ä¸­å‡ºç°å„ç§é”™è¯¯

**è§£å†³æ–¹æ³•**ï¼š
- æ¸…ç†æ„å»ºç¼“å­˜ï¼š
  ```bash
  rm -rf .next .open-next dist
  ```
- é‡æ–°æ„å»ºï¼š
  ```bash
  npm run build
  ```

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°åŠŸèƒ½

1. åˆ›å»ºæˆ–ä¿®æ”¹ `app/page.tsx` å®ç° UI
2. åœ¨ `app/api/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„ API è·¯ç”±
3. åœ¨ `wrangler.jsonc` ä¸­é…ç½® Cloudflare èµ„æºç»‘å®š
4. åœ¨ `.dev.vars` ä¸­æ·»åŠ å¼€å‘ç¯å¢ƒå˜é‡

### æµ‹è¯•

```bash
# è¿è¡Œ ESLint
npm run lint
```

### æ„å»ºä¼˜åŒ–

- ä½¿ç”¨ `npm run build` ç”Ÿæˆç”Ÿäº§ç‰ˆæœ¬
- æ„å»ºäº§ç‰©ä¼šè‡ªåŠ¨ä¼˜åŒ–ä»¥æé«˜æ€§èƒ½

## è´¡çŒ®æŒ‡å—

### æäº¤è§„èŒƒ

è¯·éµå¾ªä»¥ä¸‹æäº¤æ¶ˆæ¯æ ¼å¼ï¼š

```
type(scope): description

body (optional)

footer (optional)
```

**ç±»å‹ï¼ˆtypeï¼‰**ï¼š
- featï¼šæ–°åŠŸèƒ½
- fixï¼šä¿®å¤ bug
- docsï¼šæ–‡æ¡£æ›´æ–°
- styleï¼šä»£ç æ ¼å¼è°ƒæ•´ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
- refactorï¼šä»£ç é‡æ„
- testï¼šæµ‹è¯•ç›¸å…³
- choreï¼šæ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨

**èŒƒå›´ï¼ˆscopeï¼‰**ï¼š
- apiï¼šAPI è·¯ç”±
- uiï¼šç”¨æˆ·ç•Œé¢
- configï¼šé…ç½®æ–‡ä»¶
- depsï¼šä¾èµ–æ›´æ–°

**ç¤ºä¾‹**ï¼š
```
feat(api): æ·»åŠ å¤©æ°”å¡ç‰‡ç¼“å­˜æœºåˆ¶

æ·»åŠ  Redis ç¼“å­˜æ”¯æŒï¼Œæé«˜å¤©æ°”å¡ç‰‡è·å–é€Ÿåº¦

Closes #123
```

### å¼€å‘æµç¨‹

1. Fork ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ï¼š`git checkout -b feat/your-feature`
3. æäº¤æ›´æ”¹ï¼š`git commit -m "feat: æ·»åŠ æ–°åŠŸèƒ½"`
4. æ¨é€åˆ°åˆ†æ”¯ï¼š`git push origin feat/your-feature`
5. åˆ›å»º Pull Request

### ä»£ç è§„èŒƒ

- ä½¿ç”¨ TypeScript è¿›è¡Œå¼€å‘
- éµå¾ª ESLint è§„åˆ™
- ä½¿ç”¨ Prettier æ ¼å¼åŒ–ä»£ç 
- ä¿æŒä»£ç ç®€æ´å’Œå¯è¯»æ€§
- ä¸ºå…³é”®å‡½æ•°æ·»åŠ ç±»å‹æ³¨è§£

## è®¸å¯è¯

MIT License

## è®¸å¯è¯

MIT License

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- é‚®ç®±ï¼šsupport@city-card.local
- GitHubï¼š[github.com/undownding/city-card](https://github.com/undownding/city-card)

## æ›´æ–°æ—¥å¿—

### v0.1.0 (2026-02-27)

- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- æ”¯æŒè‡ªåŠ¨å®šä½å’ŒåŸå¸‚è¯†åˆ«
- é›†æˆ Google AI Studio å›¾åƒç”Ÿæˆ
- ä½¿ç”¨ Cloudflare R2 å­˜å‚¨å¤©æ°”å¡ç‰‡
